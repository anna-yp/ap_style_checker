<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Submit your text</title>
</head>

<style>

  .red-underline {
    background-image: linear-gradient(
      to right,
      rgba(255, 0, 0, 0.4),
      rgba(255, 0, 0, 0.4)
    );
    background-repeat: no-repeat;
    background-size: 100% 2px;     /* thickness */
    background-position: 0 100%;   /* underline position */
    border-radius: 2px;            /* rounding */
    padding-bottom: .2px;           /* space above underline */
  }

  .box {
    width: 400px;
    height: 300px;

    background-color: #f0f0f0;
    border: 2px solid #333;

  }

  .issue-marker {
    display: inline;
  }

</style>

<body>

<h2>AP style checker</h2>

<div>
  <p>Submit article here</p>

    <form id='form' action="/checker" method="POST" onsubmit="handleSubmit(event)">
      <div class='box' id='editor' name="editor" contenteditable="true">
          "Hi," said Anna.  
      </div>

      <button type="submit">Submit article</button>
    </form>
  
</body>

<script>

  async function handleSubmit(event) {
    event.preventDefault();

    const editor = document.getElementById("editor");
    const payload = JSON.stringify({ text: editor.innerText });

    try {
      const response = await fetch("/checker", {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: payload
      });

      if (!response.ok) {
        console.error("Failed to process text", response.statusText);
        return;
      }

      const data = await response.json();
      if (data.text_with_divs) {
        editor.innerHTML = data.text_with_divs;
      }
    } catch (error) {
      console.error("Unable to reach checker", error);
    }
  }

  

// copy content into hidden

//   document.querySelector("form").addEventListener("submit", () => {
//     document.getElementById("text-content").value =
//       document.getElementById("editor").innerHTML;
//   });



  // function performReplacement() {
  //     const editor= document.getElementById('editor');
  //     const originalText = editor.textContent;

  //     const startIndex = data.start_index;
  //     const endIndex = data.end_index;
  //     const replacementText = "Mars";

  //     const newText = replaceSubstringByIndex(originalText, startIndex, endIndex, replacementText);
      
  //     // Update the div's content
  //     editableDiv.textContent = newText;

  //     // Restore the cursor position (place it at the end of the new text)
  //     setCaretPosition(editableDiv, startIndex + replacementText.length);
  //   }

  //   // Helper function to set the caret (cursor) position
  //   function setCaretPosition(element, offset) {
  //       const range = document.createRange();
  //       const selection = window.getSelection();
  //       const textNode = element.firstChild;

  //       if (textNode) {
  //           range.setStart(textNode, Math.min(offset, textNode.length));
  //           range.setEnd(textNode, Math.min(offset, textNode.length));
  //           selection.removeAllRanges();
  //           selection.addRange(range);
  //       }
  //   }
</script>
